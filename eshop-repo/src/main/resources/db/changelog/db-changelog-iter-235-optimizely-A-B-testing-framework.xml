<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet author="CONNECT_APP" id="ITER_235_ADD_OPTIMIZELY_AB_TESTING_FRAMEWORK">
        <sql>
			DECLARE @SETTING_KEY nvarchar(100) = N'optimizely_id'
			DECLARE @DATA TABLE(collection_id int, optimizely_id varchar(100))
			DECLARE @ddchId int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='derendinger-ch')
			DECLARE @mtchId int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='matik-ch') 
			DECLARE @wbbId int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='wbb') 
			DECLARE @technoId int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='technomag') 
			DECLARE @ddatId int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='derendinger-at') 
			DECLARE @mtatId int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='matik-at') 
			DECLARE @axcz int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='ax-cz')
			DECLARE @wtsb int = (SELECT ID FROM dbo.ORGANISATION_COLLECTION WHERE SHORTNAME ='wt-sb') 
			
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21215120277' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @ddchId AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21536410205' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @mtchId AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21569350153' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @wbbId AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21530801061' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @technoId AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)	    
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21516570933' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @ddatId AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21557870341' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @mtatId AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21540701702' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @axcz AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
			INSERT INTO dbo.ORG_COLLECTION_SETTINGS (COLLECTION_ID, SETTING_KEY, SETTING_VALUE)
				SELECT oc.ID,@SETTING_KEY,'21547212207' FROM ORGANISATION_COLLECTION oc WHERE oc.AFFILIATE_ID = @wtsb AND 
				    NOT EXISTS (SELECT * FROM dbo.ORG_COLLECTION_SETTINGS ocs WHERE oc.ID = ocs.COLLECTION_ID AND ocs.SETTING_KEY = @SETTING_KEY)
        </sql>
    </changeSet>

</databaseChangeLog>
