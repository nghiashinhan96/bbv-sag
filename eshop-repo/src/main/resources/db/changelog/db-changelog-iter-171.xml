<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

	<changeSet author="CONNECT_APP"
		id="ITER_171_MIGRATED_SALES_ONBEHALF_VEHICLE_HISTORY">
		<sql>
			declare @salesOnBehalfUserType varchar(50) = 'ON_BEHALF_ADMIN'

			UPDATE dbo.USER_VEHICLE_HISTORY SET FROM_SOURCE = 'C4S' WHERE USER_ID IN
			(SELECT u.ID FROM dbo.ESHOP_USER u WHERE u.TYPE =
			@salesOnBehalfUserType);
		</sql>
	</changeSet>

	<changeSet author="CONNECT_APP" id="ITER_171_ADD_WSS_TOUR_TOUR_SCHEMA">
		<sql>
			DROP TABLE IF EXISTS WSS_TOUR
			
			CREATE TABLE WSS_TOUR (
			ID int IDENTITY(1,1) NOT NULL,
			ORG_ID int NOT NULL,
			NAME varchar(255) NOT NULL)
			
			DROP TABLE IF EXISTS WSS_TOUR_TIMES
			
			CREATE TABLE WSS_TOUR_TIMES (
			ID int IDENTITY(1,1) NOT NULL,
			WSS_TOUR_ID int NOT NULL,
			WEEK_DAY_NO varchar(255) NOT NULL,
			DEPARTURE_TIME time(0))
		
		</sql>
	</changeSet>
	
	<changeSet author="CONNECT_APP" id="ITER_171_ALTER_WSS_DELIVERY_PROFILE_SCHEMA">
		<sql>
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS COUNTRY
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS WSS_DELIVERY_PROFILE_ID
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS WSS_DISTRIBUTION_BRANCH_ID
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS WSS_DELIVERY_BRANCH_ID
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS NEXT_DAY
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS VENDOR_CUT_OFF_TIME
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS LAST_DELIVERY
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS LATEST_TIME
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS DELIVERY_DURATION
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS CREATED_USER_ID
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS CREATED_DATE
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS MODIFIED_USER_ID
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS MODIFIED_DATE
			ALTER TABLE WSS_DELIVERY_PROFILE DROP COLUMN IF EXISTS DELIVERY_PROFILE_NAME
			
			ALTER TABLE WSS_DELIVERY_PROFILE ADD NAME varchar(255)
			ALTER TABLE WSS_DELIVERY_PROFILE ADD DESCRIPTION varchar(255)
			ALTER TABLE WSS_DELIVERY_PROFILE ADD WSS_BRANCH_ID int
			
			
			CREATE TABLE WSS_DELIVERY_PROFILE_TOURS (
			ID int IDENTITY(1,1) NOT NULL,
			WSS_DELIVERY_PROFILE_ID int NOT NULL,
			WSS_TOUR_ID int,
			SUPPLIER_TOUR_DAY varchar(50),
			SUPPLIER_DEPARTURE_TIME time(0),
			IS_OVER_NIGHT bit NOT NULL DEFAULT 0,
			PICKUP_WAIT_DURATION int)
		
		</sql>
	</changeSet>
	
	<changeSet author="CONNECT_APP" id="ITER_171_DROP_WSS_TOUR_TIME_SCHEMA">
		<sql>
			DROP TABLE IF EXISTS WSS_TOUR_TIME
		</sql>
	</changeSet>
	
	<changeSet author="CONNECT_APP" id="ITER_171_ADD_WSS_DELIVERY_PROFILE_FINAL_CUSTOMER_SETTING">
		<sql>
			ALTER TABLE CUSTOMER_SETTINGS ADD WSS_DELIVERY_PROFILE_ID int
		</sql>
	</changeSet>

</databaseChangeLog>