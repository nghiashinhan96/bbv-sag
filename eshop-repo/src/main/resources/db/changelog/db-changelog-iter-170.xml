<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

	<changeSet author="CONNECT_APP" id="ITER_170_ADD_WSS_TOUR_SCHEMA">
		<sql>

			CREATE TABLE WSS_WORKING_DAY (
			ID int IDENTITY(1,1) NOT NULL,
			CODE varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
			DESCRIPTION varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			CONSTRAINT PK_WSS_WORKING_DAY PRIMARY KEY (ID)
			)

			CREATE TABLE WSS_TOUR_TIME (
			ID int IDENTITY(1,1) NOT NULL,
			ORG_ID int NOT NULL,
			CUSTOMER_NUMBER varchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
			WSS_BRANCH_ID varchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			TOUR_NAME varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			CONSTRAINT PK_WSS_TOUR_TIME_ID PRIMARY KEY (ID)
			)
			
			CREATE NONCLUSTERED INDEX IDX_WSS_TOUR_TIME_BRANCH_ID ON dbo.WSS_TOUR_TIME
			( WSS_BRANCH_ID ASC )
			WITH ( PAD_INDEX = OFF ,FILLFACTOR = 100 ,SORT_IN_TEMPDB = OFF ,
			IGNORE_DUP_KEY = OFF , STATISTICS_NORECOMPUTE = OFF , ONLINE = OFF ,
			ALLOW_ROW_LOCKS = ON , ALLOW_PAGE_LOCKS = ON )
			ON [PRIMARY ]
			
			CREATE NONCLUSTERED INDEX IDX_WSS_TOUR_TIME_CUST_NR ON dbo.WSS_TOUR_TIME (
			CUSTOMER_NUMBER ASC )
			WITH ( PAD_INDEX = OFF ,FILLFACTOR = 100 ,SORT_IN_TEMPDB = OFF ,
			IGNORE_DUP_KEY = OFF , STATISTICS_NORECOMPUTE = OFF , ONLINE = OFF ,
			ALLOW_ROW_LOCKS = ON , ALLOW_PAGE_LOCKS = ON )
			ON [PRIMARY ]

			CREATE TABLE WSS_OPENING_DAYS_CALENDAR (
			ID int IDENTITY(1,1) NOT NULL,
			ORG_ID int NOT NULL,
			[DATETIME] date NOT NULL,
			COUNTRY_ID int NOT NULL,
			WSS_WORKING_DAY_ID int NOT NULL,
			EXCEPTIONS varchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			CONSTRAINT PK_WSS_OPENING_DAYS_CALENDAR PRIMARY KEY (ID)
			)

			CREATE TABLE WSS_DELIVERY_PROFILE (
			ID int IDENTITY(1,1) NOT NULL,
			ORG_ID int NOT NULL,
			COUNTRY nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			WSS_DELIVERY_PROFILE_ID int NOT NULL,
			WSS_DISTRIBUTION_BRANCH_ID int NOT NULL,
			WSS_DELIVERY_BRANCH_ID int NOT NULL,
			NEXT_DAY int NULL,
			VENDOR_CUT_OFF_TIME time NULL,
			LAST_DELIVERY time NOT NULL,
			LATEST_TIME time NULL,
			DELIVERY_DURATION int NOT NULL,
			CREATED_USER_ID bigint NULL,
			CREATED_DATE datetime NULL,
			MODIFIED_USER_ID bigint NULL,
			MODIFIED_DATE datetime NULL,
			DELIVERY_PROFILE_NAME nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			CONSTRAINT PK_WSS_DELIVERY_PROFILE PRIMARY KEY (ID)
			)

			CREATE TABLE WSS_BRANCH (
			ID int IDENTITY(1,1) NOT NULL,
			BRANCH_NUMBER int NOT NULL,
			BRANCH_CODE varchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
			ORG_ID int NOT NULL,
			ZIP varchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			ADDRESS_STREET varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS
			NULL,
			ADDRESS_CITY varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			ADDRESS_DESC varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			ADDRESS_COUNTRY varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS
			NULL,
			COUNTRY_ID int NULL,
			REGION_ID varchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			PRIMARY_FAX varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			PRIMARY_EMAIL varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			PRIMARY_PHONE varchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			PRIMARY_URL varchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			ID_KSL bit NULL,
			OPENING_TIME time NOT NULL,
			CLOSING_TIME time NOT NULL,
			LUNCH_START_TIME time NULL,
			LUNCH_END_TIME time NULL,
			CONSTRAINT PK_WSS_BRANCH PRIMARY KEY (ID)
			)
		</sql>
	</changeSet>
	<changeSet author="CONNECT_APP"	id="ITER_170_INIT_WSS_WORKING_DAY_DATA">
		<sql>
			INSERT INTO WSS_WORKING_DAY (CODE, DESCRIPTION) VALUES('WORKING_DAY', NULL)
			INSERT INTO WSS_WORKING_DAY (CODE, DESCRIPTION) VALUES('NON_WORKING_DAY', NULL)
			INSERT INTO WSS_WORKING_DAY (CODE, DESCRIPTION) VALUES('PUBLIC_HOLIDAY', NULL)
		</sql>
	</changeSet>
	<changeSet author="CONNECT_APP"	id="ITER_170_DROP_WSS_BRANCH_UNUSED_COLUMN">
		<sql>
			ALTER TABLE WSS_BRANCH DROP COLUMN ZIP
			ALTER TABLE WSS_BRANCH DROP COLUMN ADDRESS_STREET
			ALTER TABLE WSS_BRANCH DROP COLUMN ADDRESS_CITY
			ALTER TABLE WSS_BRANCH DROP COLUMN ADDRESS_DESC
			ALTER TABLE WSS_BRANCH DROP COLUMN ADDRESS_COUNTRY
			ALTER TABLE WSS_BRANCH DROP COLUMN COUNTRY_ID
			ALTER TABLE WSS_BRANCH DROP COLUMN REGION_ID
			ALTER TABLE WSS_BRANCH DROP COLUMN PRIMARY_FAX
			ALTER TABLE WSS_BRANCH DROP COLUMN PRIMARY_EMAIL
			ALTER TABLE WSS_BRANCH DROP COLUMN PRIMARY_PHONE
			ALTER TABLE WSS_BRANCH DROP COLUMN PRIMARY_URL
			ALTER TABLE WSS_BRANCH DROP COLUMN ID_KSL
		</sql>
	</changeSet>
	<changeSet author="CONNECT_APP"	id="ITER_170_ALTER_WSS_BRANCH_TIME_COLUMNS">
		<sql>
			ALTER TABLE WSS_BRANCH ALTER COLUMN OPENING_TIME time(0) NOT NULL
			ALTER TABLE WSS_BRANCH ALTER COLUMN CLOSING_TIME time(0) NOT NULL
			ALTER TABLE WSS_BRANCH ALTER COLUMN LUNCH_START_TIME time(0) NULL
			ALTER TABLE WSS_BRANCH ALTER COLUMN LUNCH_END_TIME time(0) NULL
		</sql>
	</changeSet>
	
</databaseChangeLog>