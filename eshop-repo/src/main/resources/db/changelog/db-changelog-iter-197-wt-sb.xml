<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet author="CONNECT_APP" id="ITER_197_UPDATE_FEEDBACK_CONTACT_EMAIL_FOR_WT_SB">
    <sql>
    	IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'PRICING_FEEDBACK_DEPARTMENT')
		BEGIN
	     	INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('PRICING_FEEDBACK_DEPARTMENT', '')
			DECLARE @pricingDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@pricingDeptId, 'EMAIL', 'nabavka@wint.rs')
			DECLARE @pricingTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='PRICING')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@pricingDeptId WHERE TOPIC_ID= @pricingTopicId
		END 
		
		IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'ORDERS_FEEDBACK_DEPARTMENT')
		BEGIN
			INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('ORDERS_FEEDBACK_DEPARTMENT', '')
			DECLARE @orderDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@orderDeptId, 'EMAIL', 'nabavka@wint.rs')
			DECLARE @orderTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='ORDERS_AVAILABILITY')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@orderDeptId WHERE TOPIC_ID= @orderTopicId
		END
		
		IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'EASE_FEEDBACK_DEPARTMENT')
		BEGIN
			INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('EASE_FEEDBACK_DEPARTMENT', '')
			DECLARE @easeDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@easeDeptId, 'EMAIL', 'predrag.radjenovic@wint.rs')
			DECLARE @easeTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='EASE_OF_USE')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@easeDeptId WHERE TOPIC_ID= @easeTopicId
		END
		
		IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'MISSING_DATA_FEEDBACK_DEPARTMENT')
		BEGIN
			INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('MISSING_DATA_FEEDBACK_DEPARTMENT', '')
			DECLARE @wrongDataDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@wrongDataDeptId, 'EMAIL', 'nabavka@wint.rs')
			DECLARE @wrongDataTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='MISSING_WRONG_DATA')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@wrongDataDeptId WHERE TOPIC_ID= @wrongDataTopicId
		END
		IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'LICENSING_FEEDBACK_DEPARTMENT')
		BEGIN
			INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('LICENSING_FEEDBACK_DEPARTMENT', '')
			DECLARE @licensingDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@licensingDeptId, 'EMAIL', 'predrag.radjenovic@wint.rs')
			DECLARE @licensingTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='LICENSING')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@licensingDeptId WHERE TOPIC_ID= @licensingTopicId
		END
		
		IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'SYSTEM_FEEDBACK_DEPARTMENT')
		BEGIN
			INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('SYSTEM_FEEDBACK_DEPARTMENT', '')
			DECLARE @systemDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@systemDeptId, 'EMAIL', 'dusan.zrnic@wint.rs')
			DECLARE @systemTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='SYSTEM_BROWSER_INTERFACES')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@systemDeptId WHERE TOPIC_ID= @systemTopicId
		END
		
		IF NOT EXISTS  (SELECT 1 FROM FEEDBACK_DEPARTMENT WHERE DEPARTMENT_CODE = 'PROFILE_SETTING_FEEDBACK_DEPARTMENT')
		BEGIN
			INSERT INTO FEEDBACK_DEPARTMENT (DEPARTMENT_CODE, DESCRIPTION) VALUES('PROFILE_SETTING_FEEDBACK_DEPARTMENT', '')
			DECLARE @profileDeptId int = (SELECT @@IDENTITY)
			INSERT INTO FEEDBACK_DEPARTMENT_CONTACT (DEPARTMENT_ID, [TYPE], VALUE) VALUES(@profileDeptId, 'EMAIL', 'predrag.radjenovic@wint.rs')
			DECLARE @profileTopicId int = (SELECT ID FROM dbo.FEEDBACK_TOPIC WHERE TOPIC_CODE ='PROFILE_SETTINGS')
			UPDATE FEEDBACK_TOPIC_DEPARTMENT SET DEPARTMENT_ID=@profileDeptId WHERE TOPIC_ID= @profileTopicId
		END
    </sql>
  </changeSet>
</databaseChangeLog>
